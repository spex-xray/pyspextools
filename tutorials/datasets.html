
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Managing datasets in pyspextools &#8212; pyspextools 0.4.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="User model example" href="myusermodel.html" />
    <link rel="prev" title="SIMRES - Create simulation files based on existing response" href="simres.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="managing-datasets-in-pyspextools">
<h1>Managing datasets in pyspextools<a class="headerlink" href="#managing-datasets-in-pyspextools" title="Permalink to this headline">¶</a></h1>
<p>The best starting point to manipulate SPEX files is to use the Dataset class in pyspextools. A dataset can be a
collection of several spectrum-response combinations, which are called regions. This way, multiple related spectra can
be stored in a spo and res file.</p>
<p>The different spectra and responses inside a dataset can be related to each other in multiple ways. To distinguish
between different cases, each spectrum-response combination can have a sector and region number. These numbers are
defined as follows:</p>
<dl class="simple">
<dt><strong>Sector</strong></dt><dd><p>A sector number refers to the model that needs to be associated to the dataset. Suppose one has spectra from two
areas of the sky that share a common absorption component, but have different emission components. One would like
to fit these spectra simultaneously with coupled absorption components. The SPEX solution is to assign different
sector numbers to the different spectra, such that SPEX applies the right models to the right dataset.</p>
</dd>
<dt><strong>Region</strong></dt><dd><p>A region number identifies the dataset that a model applies to. Usually the region number just iterates over the
number of spectra, so four spectra are just counted as 1, 2, 3 and 4.</p>
</dd>
</dl>
<p>However, in some cases it can be helpful to point different sectors to one region. For example, a particle background
model is not supposed to be multiplied by the effective area, but just the response. Then this model needs to be added
to the model spectrum of the previous region. In that case, two spectrum-response combinations are required (one with
and one without ARF), where each combination obtains its own sector number (1,2), but only a single region number(1).
See the <a class="reference external" href="http://var.sron.nl/SPEX-doc/cookbookv3.0/cookbookch8.html#x36-570008">SPEX Cookbook</a> for more information.</p>
<div class="section" id="example-use-of-the-dataset-class">
<h2>Example use of the dataset class<a class="headerlink" href="#example-use-of-the-dataset-class" title="Permalink to this headline">¶</a></h2>
<p>Let’s perform a simple operation to read a few existing spo and res files and combine them into one dataset.
First, start python and then import the pyspextools.io module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyspextools.io</span>
</pre></div>
</div>
<p>The pyspextools.io module contains a Dataset class that needs to be initiated first:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">pyspextools</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
</pre></div>
</div>
<p>The Dataset class contains methods to read spo and res files into a region. Suppose we have two spectra from the
RGS instrument aboard XMM-Newton. We have two sets of spectra and responses: RGS1.spo, RGS1.res, RGS2.spo and RGS2.res.
We can read them into the dataset easily using the read_all_regions method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">read_all_regions</span><span class="p">(</span><span class="s2">&quot;RGS1.spo&quot;</span><span class="p">,</span><span class="s2">&quot;RGS1.res&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">read_all_regions</span><span class="p">(</span><span class="s2">&quot;RGS2.spo&quot;</span><span class="p">,</span><span class="s2">&quot;RGS2.res&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This method reads all regions within a file and adds it to the dataset. In this case, the spectral files only contain
one region, so by reading them in both, we have now two parts of the dataset:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">===========================================================</span>
<span class="go"> Part 1</span>
<span class="go">===========================================================</span>
<span class="go"> Sector:            1  =&gt;  Region:            1</span>
<span class="go"> Label:</span>
<span class="go"> --------------------  Spectrum  -------------------------</span>
<span class="go"> Original spo file                      :  RGS1.spo</span>
<span class="go"> Number of data channels                :  2831</span>
<span class="go"> Data energy range                      :  0.32 - 2.41 keV</span>
<span class="go"> Exposure time mean                     :  104813.48 s</span>
<span class="go"> --------------------  Response  -------------------------</span>
<span class="go"> Original response file name            :  RGS1.res</span>
<span class="go"> Number of data channels in response    :  2831</span>
<span class="go"> Number of response components          :  8</span>

<span class="go">===========================================================</span>
<span class="go"> Part 2</span>
<span class="go">===========================================================</span>
<span class="go"> Sector:            1  =&gt;  Region:            2</span>
<span class="go"> Label:</span>
<span class="go"> --------------------  Spectrum  -------------------------</span>
<span class="go"> Original spo file                      :  RGS2.spo</span>
<span class="go"> Number of data channels                :  2728</span>
<span class="go"> Data energy range                      :  0.33 - 2.64 keV</span>
<span class="go"> Exposure time mean                     :  104409.24 s</span>
<span class="go"> --------------------  Response  -------------------------</span>
<span class="go"> Original response file name            :  RGS2.res</span>
<span class="go"> Number of data channels in response    :  2728</span>
<span class="go"> Number of response components          :  8</span>
</pre></div>
</div>
<p>Suppose one wants to apply a different model for RGS2 than for RGS1 and put RGS2 in a different sector, then we can do
that as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">assign_sector</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">===========================================================</span>
<span class="go"> Part 1</span>
<span class="go">===========================================================</span>
<span class="go"> Sector:            1  =&gt;  Region:            1</span>
<span class="go"> Label:</span>
<span class="go"> --------------------  Spectrum  -------------------------</span>
<span class="go"> Original spo file                      :  RGS1.spo</span>
<span class="go"> Number of data channels                :  2831</span>
<span class="go"> Data energy range                      :  0.32 - 2.41 keV</span>
<span class="go"> Exposure time mean                     :  104813.48 s</span>
<span class="go"> --------------------  Response  -------------------------</span>
<span class="go"> Original response file name            :  RGS1.res</span>
<span class="go"> Number of data channels in response    :  2831</span>
<span class="go"> Number of response components          :  8</span>

<span class="go">===========================================================</span>
<span class="go"> Part 2</span>
<span class="go">===========================================================</span>
<span class="go"> Sector:            2  =&gt;  Region:            2</span>
<span class="go"> Label:</span>
<span class="go"> --------------------  Spectrum  -------------------------</span>
<span class="go"> Original spo file                      :  RGS2.spo</span>
<span class="go"> Number of data channels                :  2728</span>
<span class="go"> Data energy range                      :  0.33 - 2.64 keV</span>
<span class="go"> Exposure time mean                     :  104409.24 s</span>
<span class="go"> --------------------  Response  -------------------------</span>
<span class="go"> Original response file name            :  RGS2.res</span>
<span class="go"> Number of data channels in response    :  2728</span>
<span class="go"> Number of response components          :  8</span>
</pre></div>
</div>
<p>In the data.show() command, the part with the RGS2 spectrum (Part 2) has now sector 2 assigned to it. We can now save
the created structure to one spo and res file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">write_all_regions</span><span class="p">(</span><span class="s2">&quot;RGS.spo&quot;</span><span class="p">,</span><span class="s2">&quot;RGS.res&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The dataset has been successfully written to RGS.spo and RGS.res.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo-wide.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Install pyspextools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Pyspextools tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#using-the-pyspextools-scripts">Using the pyspextools scripts</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../tutorials.html#using-the-pyspextools-api">Using the pyspextools API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#using-the-spex-user-model">Using the SPEX user model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Module reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../tutorials.html">Pyspextools tutorials</a><ul>
      <li>Previous: <a href="simres.html" title="previous chapter">SIMRES - Create simulation files based on existing response</a></li>
      <li>Next: <a href="myusermodel.html" title="next chapter">User model example</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018-2021, SRON Netherlands Institute for Space Research.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.1.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/tutorials/datasets.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>